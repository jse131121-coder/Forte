<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FORTE</title>

<style>
body{
  margin:0;
  background:#fff;
  color:#000;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  display:flex;
  justify-content:center;
}
.app{
  width:100%;
  max-width:420px;
  min-height:100vh;
  border-left:1px solid #ddd;
  border-right:1px solid #ddd;
}
header{
  padding:14px;
  text-align:center;
  border-bottom:1px solid #ddd;
  font-weight:600;
}
section{
  display:none;
  padding:16px;
  padding-bottom:90px;
}
section.active{display:block}
nav{
  position:fixed;
  bottom:0;
  width:100%;
  max-width:420px;
  display:flex;
  border-top:1px solid #ddd;
  background:#fff;
}
nav button{
  flex:1;
  padding:12px 0;
  background:none;
  border:none;
  font-size:12px;
}
nav button.active{font-weight:600}

.card{
  border:1px solid #ddd;
  border-radius:12px;
  padding:14px;
  margin-bottom:12px;
}
textarea,input{
  width:100%;
  padding:10px;
  border:1px solid #ccc;
  border-radius:8px;
  margin-bottom:8px;
}
button.primary{
  width:100%;
  padding:12px;
  border:none;
  border-radius:8px;
  background:#000;
  color:#fff;
  font-weight:600;
}
button.sub{
  width:100%;
  padding:10px;
  border:1px solid #000;
  background:#fff;
  margin-bottom:8px;
}

.chat-box{
  display:flex;
  flex-direction:column;
  gap:6px;
}
.msg{
  max-width:75%;
  padding:8px 12px;
  border-radius:12px;
  font-size:13px;
  white-space:pre-wrap;
}
.fan{
  background:#000;
  color:#fff;
  align-self:flex-end;
}
.artist{
  background:#eee;
  align-self:flex-start;
}
.artist-wrap{
  display:flex;
  gap:8px;
  align-items:flex-start;
}
.artist-wrap img{
  width:32px;
  height:32px;
  border-radius:50%;
  object-fit:cover;
}
.artist-name{
  font-size:11px;
  font-weight:600;
  margin-bottom:2px;
}
.date{
  text-align:center;
  font-size:11px;
  color:#666;
  margin:12px 0;
}
.admin-tools{
  font-size:11px;
  margin-top:6px;
  display:flex;
  gap:10px;
}
.pin{font-weight:600}

.modal{
  position:fixed;
  inset:0;
  background:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:999;
}
.modal-box{
  width:90%;
  max-width:320px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="modal" id="loginModal">
  <div class="modal-box">
    <h3>LOGIN</h3>
    <input id="loginId" placeholder="ID">
    <input id="loginPw" type="password" placeholder="Password">
    <button class="primary" onclick="login()">ENTER</button>
  </div>
</div>

<div class="app" id="app" style="display:none">
<header id="headerTitle">FORTE</header>

<section id="community" class="active">
  <textarea id="postText" placeholder="Write something..."></textarea>
  <button class="primary" onclick="addPost()">POST</button>
  <div id="posts"></div>
</section>

<section id="chat">
  <div class="chat-box" id="chatBox"></div>
  <textarea id="chatInput" placeholder="Message..."></textarea>
  <button class="primary" onclick="sendChat()">SEND</button>
</section>

<section id="admin">
  <div class="card">
    <h4>Forte Profile</h4>
    <input type="file" accept="image/*" onchange="uploadProfile(this)">
  </div>
  <div class="card">
    <h4>Add Account</h4>
    <input id="newId" placeholder="ID">
    <input id="newPw" placeholder="Password">
    <button class="sub" onclick="addAccount()">ADD</button>
  </div>
</section>

<nav>
  <button class="active" onclick="go('community',this)">COMMUNITY</button>
  <button onclick="go('chat',this)">CHAT</button>
  <button id="adminBtn" onclick="go('admin',this)">ADMIN</button>
</nav>
</div>

<script>
/* STATE */
let role=null;
let accounts=JSON.parse(localStorage.getItem("accounts"))||[
  {id:"Artist",pw:"Artist",role:"fan"},
  {id:"Forte",pw:"01024773752",role:"artist"}
];
let posts=JSON.parse(localStorage.getItem("posts"))||[];
let chats=JSON.parse(localStorage.getItem("chats"))||[];
let profileImg=localStorage.getItem("profileImg")||"";

/* LOGIN */
function login(){
  const id=loginId.value.trim();
  const pw=loginPw.value.trim();
  const acc=accounts.find(a=>a.id===id && a.pw===pw);
  if(!acc){alert("ë¡œê·¸ì¸ ì‹¤íŒ¨");return;}
  role=acc.role;
  loginModal.style.display="none";
  app.style.display="block";
  if(role!=="artist") adminBtn.style.display="none";
  renderPosts(); renderChat();
}

/* ACCOUNTS */
function addAccount(){
  accounts.push({id:newId.value,pw:newPw.value,role:"fan"});
  localStorage.setItem("accounts",JSON.stringify(accounts));
  alert("ê³„ì • ì¶”ê°€ë¨");
  newId.value=""; newPw.value="";
}

/* PROFILE */
function uploadProfile(input){
  const file=input.files[0];
  const reader=new FileReader();
  reader.onload=()=>{
    profileImg=reader.result;
    localStorage.setItem("profileImg",profileImg);
    alert("í”„ë¡œí•„ ì €ìž¥ë¨");
    renderChat();
  };
  reader.readAsDataURL(file);
}

/* COMMUNITY */
function addPost(){
  if(!postText.value) return;
  posts.unshift({text:postText.value,pin:false});
  savePosts(); postText.value="";
}
function savePosts(){
  localStorage.setItem("posts",JSON.stringify(posts));
  renderPosts();
}
function renderPosts(){
  posts.sort((a,b)=>b.pin-a.pin);
  postsEl.innerHTML="";
  posts.forEach((p,i)=>{
    postsEl.innerHTML+=`
      <div class="card">
        ${p.pin?'<div class="pin">ðŸ“Œ ê³ ì •</div>':''}
        <div>${p.text}</div>
        ${role==="artist"?`
        <div class="admin-tools">
          <span onclick="editPost(${i})">ìˆ˜ì •</span>
          <span onclick="deletePost(${i})">ì‚­ì œ</span>
          <span onclick="togglePin(${i})">ê³ ì •</span>
        </div>`:""}
      </div>`;
  });
}
function editPost(i){
  const t=prompt("ìˆ˜ì •",posts[i].text);
  if(t!==null){posts[i].text=t;savePosts();}
}
function deletePost(i){
  if(confirm("ì‚­ì œ?")){posts.splice(i,1);savePosts();}
}
function togglePin(i){
  posts[i].pin=!posts[i].pin;
  savePosts();
}

/* CHAT */
function sendChat(){
  if(!chatInput.value) return;
  chats.push({
    text:chatInput.value,
    role,
    date:new Date().toDateString()
  });
  localStorage.setItem("chats",JSON.stringify(chats));
  chatInput.value="";
  renderChat();
}
function renderChat(){
  chatBox.innerHTML="";
  let last="";
  chats.forEach((m,i)=>{
    if(m.date!==last){
      chatBox.innerHTML+=`<div class="date">${m.date}</div>`;
      last=m.date;
    }
    if(m.role==="artist"){
      chatBox.innerHTML+=`
      <div class="artist-wrap" ondblclick="adminChat(${i})">
        ${profileImg?`<img src="${profileImg}">`:""}
        <div>
          <div class="artist-name">Forte</div>
          <div class="msg artist">${m.text}</div>
        </div>
      </div>`;
    }else{
      chatBox.innerHTML+=`
      <div class="msg fan">${m.text}</div>`;
    }
  });
}
function adminChat(i){
  if(role!=="artist") return;
  const a=prompt("1 ìˆ˜ì • / 2 ì‚­ì œ");
  if(a==="1"){
    const t=prompt("ìˆ˜ì •",chats[i].text);
    if(t!==null) chats[i].text=t;
  }else if(a==="2"){
    chats.splice(i,1);
  }
  localStorage.setItem("chats",JSON.stringify(chats));
  renderChat();
}

/* NAV */
function go(id,btn){
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
}
</script>
</body>
</html>

